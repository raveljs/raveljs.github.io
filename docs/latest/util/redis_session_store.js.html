<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" charset="utf-8">
    <title>Ravel 0.17.8 API Reference</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../css/prism.min.css">
    <link rel="stylesheet" href="../css/index.min.css">
    <link rel="stylesheet" href="../css/docs.min.css">
  </head>
  <body data-spy="scroll" data-target=".scrollspy">
    <header id="overview" class="jumbotron subhead">
      <div class="container"><img src="../css/logo2.png">
        <h1>Ravel 0.17.8 API Reference</h1>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="col-sm-3 bs-docs-sidebar">
          <ul class="nav nav-list bs-docs-sidenav affix-top">
            <li><a href="../index.html">Main</a></li>
            <li><a href="../auth/authentication_provider.js.html">auth/authentication_provider.js</a></li>
            <li><a href="../auth/decorators/authconfig.js.html">auth/decorators/authconfig.js</a></li>
            <li><a href="../auth/decorators/authenticated.js.html">auth/decorators/authenticated.js</a></li>
            <li><a href="../core/decorators/before.js.html">core/decorators/before.js</a></li>
            <li><a href="../core/decorators/inject.js.html">core/decorators/inject.js</a></li>
            <li><a href="../core/decorators/lifecycle.js.html">core/decorators/lifecycle.js</a></li>
            <li><a href="../core/decorators/mapping.js.html">core/decorators/mapping.js</a></li>
            <li><a href="../core/module.js.html">core/module.js</a></li>
            <li><a href="../core/modules.js.html">core/modules.js</a></li>
            <li><a href="../core/params.js.html">core/params.js</a></li>
            <li><a href="../core/reflect.js.html">core/reflect.js</a></li>
            <li><a href="../core/resource.js.html">core/resource.js</a></li>
            <li><a href="../core/resources.js.html">core/resources.js</a></li>
            <li><a href="../core/routes.js.html">core/routes.js</a></li>
            <li><a href="../db/database_provider.js.html">db/database_provider.js</a></li>
            <li><a href="../db/decorators/transaction.js.html">db/decorators/transaction.js</a></li>
            <li><a href="../ravel.js.html">ravel.js</a></li>
            <li><a href="../util/application_error.js.html">util/application_error.js</a></li>
            <li><a href="../util/http_codes.js.html">util/http_codes.js</a></li>
            <li><a href="../util/log.js.html">util/log.js</a></li>
            <li class="active"><a href="../util/redis_session_store.js.html">util/redis_session_store.js</a></li>
          </ul>
          <div class="scrollspy">
            <ul class="nav nav-list bs-docs-sidenav affix-top">
            </ul>
          </div>
        </div>
        <div class="col-sm-9">
          <div class="description"></div><a role="button" data-toggle="collapse" data-target="#0" aria-expanded="false" aria-controls="0" class="btn btn-default btn-sm">Source</a>
          <div id="0" class="collapse">
            <pre><code class="language-javascript">'use strict';

const EventEmitter = require('events').EventEmitter;
const sRavelInstance = Symbol();

function finishBasicPromise(resolve, reject) {
  return (err, res) =&gt; {
    if (err) { return reject(err); }
    else { return resolve(res); }
  };
};

class RedisSessionStore extends EventEmitter {
  constructor(ravelInstance) {
    super();
    this[sRavelInstance] = ravelInstance;
    this[sRavelInstance].kvstore.on('connect', this.emit.bind(this, 'connect'));
    if (this[sRavelInstance].kvstore.connected) {
      this.emit('connect');
    }
    this[sRavelInstance].kvstore.on('error', this.emit.bind(this, 'error'));
    this[sRavelInstance].kvstore.on('end', this.emit.bind(this, 'end'));
    this[sRavelInstance].kvstore.on('end', this.emit.bind(this, 'disconnect')); // For backwards compatibility
    this[sRavelInstance].kvstore.on('connect', this.emit.bind(this, 'connect'));
    this[sRavelInstance].kvstore.on('reconnecting', this.emit.bind(this, 'reconnecting'));
    this[sRavelInstance].kvstore.on('ready', this.emit.bind(this, 'ready'));
    this[sRavelInstance].kvstore.on('warning', this.emit.bind(this, 'warning'));
  }

  get connected() {
    return this[sRavelInstance].kvstore.connected;
  }

  get(sid) {
    return new Promise((resolve, reject) =&gt; {
      this[sRavelInstance].kvstore.get(sid, (err, res) =&gt; {
        if (err) { return reject(err); }
        else if (res !== null &amp;&amp; res !== undefined) { return resolve(JSON.parse(res)); }
        else { return resolve(res); }
      });
    });
  }

  set(sid, sess, ttl) {
    return new Promise((resolve, reject) =&gt; {
      if (typeof ttl === 'number') {
        ttl = Math.ceil(ttl / 1000);
      }
      const jsess = JSON.stringify(sess);
      if (ttl !== undefined) {
        this[sRavelInstance].kvstore.setex(sid, ttl, jsess, finishBasicPromise(resolve, reject));
      } else {
        this[sRavelInstance].kvstore.set(sid, jsess, finishBasicPromise(resolve, reject));
      }
    });
  }

  destroy(sid) {
    return new Promise((resolve, reject) =&gt; {
      this[sRavelInstance].kvstore.del(sid, finishBasicPromise(resolve, reject));
    });
  }

  quit() {
    // Do nothing. We'll let ravel manage its own redis connection - we're just borrowing it.
  }

  end() {
    this.quit();
  }
}

module.exports = RedisSessionStore;</code></pre>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p>Documentation generated with&nbsp;<a href="https://github.com/mr-doc/mr-doc">Mr. Doc</a> created by&nbsp;<a href="https://twitter.com/FGRibreau" data-show-count="false" class="twitter-follow-button">Francois-Guillaume Ribreau</a></p>
        <p>Mr. Doc is sponsored by&nbsp;<a href="http://bringr.net/?btt" title="Outil d'analyse des rÃ©seaux sociaux" class="bringr">Bringr</a> and&nbsp;<a href="https://redsmin.com/?btt" title="Full Redis GUI" class="redsmin">Redsmin</a></p>
        <p>Theme borrowed from Twitter Bootstrap</p>
      </div>
    </footer>
    <script src="../js/twitter-widget.min.js"></script>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/prism.min.js"></script>
    <script src="../js/index.min.js"></script>
  </body>
</html>